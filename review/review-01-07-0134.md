• 이슈
                                                                                                                          
  - [높음] PyMuPDF 이미지 블록 OCR이 사실상 동작하지 않을 가능성이 큽니다. get_text("dict") 블록에는 원본 이미지 바이트가 
    없어 block.get("image")가 None이 되는 경우가 많아 그림/스캔 텍스트가 임베딩에서 누락됩니다. ingestion/parsers/        
    pymupdf_parser.py:259 ingestion/parsers/pymupdf_parser.py:331                                                         
  - [높음] OCR fallback이 문서 전체 _is_sparse 결과에만 의존합니다. 혼합 PDF(텍스트+스캔)는 OCR이 스킵되어 텍스트 없는 페 
    이지가 누락될 수 있어 유사도/리콜이 크게 떨어집니다. ingestion/parsers/pymupdf_parser.py:231 ingestion/parsers/       
    pymupdf_parser.py:397                                                                                                 
  - [높음] EmbeddingValidator의 한글 패턴/키워드가 모지바케 형태로 깨져 있어 실제 한글 문장에 매칭되지 않거나 오탐될 가능 
    성이 큽니다. 필터 품질이 흔들리면 임베딩 품질도 같이 흔들립니다. embedding/validators.py:31 embedding/validators.py:64  - [중간] OCR 텍스트 분리가 빈 줄 기준이라 OCR 출력이 단일 줄바꿈 위주일 경우 한 덩어리로 임베딩됩니다. 긴 세그먼트는 의 
    미가 희석되거나 모델이 잘라내어 유사성이 떨어집니다. shared/text_utils.py:38 ingestion/parsers/ocr.py:24
  - [중간] min_text_length/MIN_LENGTH 필터 조합이 짧은 제목·라벨을 대량으로 제거할 수 있어 검색 리콜이 낮아집니다.
    ingestion/parsers/pymupdf_parser.py:152 embedding/validators.py:29 embedding/validators.py:128
  - [중간] 결과 중복 제거가 content 기준이고 기본값이 켜져 있어(동일 문구가 여러 문서에 있는 경우) 관련 결과가 숨겨질 수
    있습니다. retrieval/grouping.py:78 retrieval/pipeline.py:75

  요약: 위 항목 때문에 현재 구조만으로는 높은 검색 유사성을 안정적으로 보장하기 어렵습니다.

  질문/가정

  - 실제 운영 데이터에서 스캔/이미지 중심 PDF 비중이 어느 정도인가요? 혼합 문서 비중에 따라 OCR 누락 영향이 크게 달라집니
    다.
  - ENABLE_AUTO_OCR/FORCE_OCR를 기본으로 켜고 있나요? shared/config.py:99 shared/config.py:100

  테스트/검증 갭

  - 통합 테스트의 PDF 경로가 pdfminer 모의에 한정되어 PyMuPDF/Gemini OCR 경로를 검증하지 않습니다. test_integration.py:150
  - 이미지 블록 OCR/혼합 PDF 품질을 검증하는 고정 쿼리셋 평가가 없어 회귀를 잡기 어렵습니다.

  변경 요약

  - 변경 없음(리뷰만 수행)

  다음 단계

  1. 스캔/혼합 PDF 몇 건으로 ingest 후 OCR 누락 여부(페이지별 텍스트 존재, 세그먼트 수)를 점검.
  2. python -m api.cli.quality --metrics 또는 python -m api.cli.quality --golden eval_queries.jsonl로 품질 지표/쿼리셋 평가.